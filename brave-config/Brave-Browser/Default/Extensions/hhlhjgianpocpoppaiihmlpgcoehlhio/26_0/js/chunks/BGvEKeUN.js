import{a as t,D as e,b as s}from"./CAmFpRSf.js";import{D as a}from"./B3DQGssQ.js";class n{static getUrl(t,e,s=!1,a=null,n=!1){const o=new URLSearchParams;if(t)for(const e of t)o.append("q",e);return e&&o.set("sortby",e),s&&o.set("invert","1"),a&&o.set("groupby",a),n&&o.set("groupby_invert","1"),`/overview.html?${o.toString()}`}static async getFormattedText(n,o,r=!1,i=null,c=!1,l="markdown",m=!1){const g=new Map,{highlightDefinitions:f}=await(new t).getAll();for(const{className:t,title:e}of f)g.set(t,e);const u=new e,h=[];n||(n=(await u.getSums()).filter((({value:t})=>t>0)).map((({key:t})=>t)));for(const t of n){let e,n,i;if(isNaN(t))e=t,n=null,i=null;else{const a=new s(t),r=await a.get();i=a.getComparisonFunction(o),e=r.url,n=r.title}const c=a.formatMatch(e);let m=await u.getMatchingDocuments(c,{excludeDeletedDocs:!0});if(!n&&(n=m.find((({title:t})=>t))?.title,!n)){const t=await u.getFirstDocuments([c],{includeDocKeys:"title"});t.length>0&&(n=t[0].title),n||(n=chrome.i18n.getMessage("untitled_page_title"))}i&&(m=await a.sortDocuments(m,i)),r&&m.reverse();let f="";if("markdown"!==l)throw new Error("unknown format");{let t;f+="# "+(n?`[${n}](${e})`:`<${e}>`);for(const{className:e,text:s}of m)e!=t&&(f+=`\n\n## ${g.get(e)}\n`,t=e),f+="\n",f+=`- ${s.replace(/\s+/g," ").trim()}`}h.push({firstDocs:m,title:n,formattedText:f})}if(i){let t;switch(i){case"title":t=({title:t},{title:e})=>(t??"").localeCompare(e??"");break;case"first_date":t=({firstDocs:t},{firstDocs:e})=>t[0]?.date-e[0]?.date;break;case"last_date":const e=await u.getLastDocumentDates();t=({firstDocs:t},{firstDocs:s})=>{const a=t[0]?.match,n=s[0]?.match;return(e.get(a)??0)-(e.get(n)??0)};break;case"highlights_count":t=({firstDocs:t},{firstDocs:e})=>t.length-e.length}h.sort(t)}c&&h.reverse();let w=h.map((({formattedText:t})=>t)).join("\n\n");return m&&"markdown"===l&&(w+=`\n\n---\n\n${chrome.i18n.getMessage("overview_footer",["extension_name","copyright_year","extension_company","extension_company_url"].map((t=>chrome.i18n.getMessage(t))))}`),w}}export{n as O};
